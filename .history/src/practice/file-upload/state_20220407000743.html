<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 上传控件
      let plugin = (function () {
        let plugin = document.createElement('embed')
        plugin.style.display = 'none'

        plugin.sign = function () {
          console.log('开始扫描')
        }

        plugin.pause = function () {
          console.log('文件暂停上传')
        }

        plugin.uploading = function () {
          console.log('文件开始上传')
        }

        plugin.del = function () {
          console.log('文件被删除')
        }

        plugin.done = function () {
          console.log('文件上传完成')
        }

        document.body.appendChild(plugin)

        return plugin
      })()

      // 上传类
      class Upload {
        constructor(filename) {
          this.filename = filename
          this.plugin = plugin // 上传的控件
          this.button1 = null // 暂停和继续上传
          this.button2 = null // 删除
          this.state = 'sign' // 初始状态
        }

        init() {
          this.dom = document.createElement('div')
          this.dom.innerHTML = `
            <span>${this.filename}</span>
            <button data-action="button1">扫描中</button>
            <button data-action="button2">删除</button>
          `
          document.body.appendChild(this.dom)
          this.button1 = document.querySelector('[data-action="button1"]')
          this.button2 = document.querySelector('[data-action="button2"]')
          this.bindEvent()
        }

        bindEvent() {
          // 给两个按钮绑定事件
          this.button1.onlick = () => {
            if (this.state === 'sign') {
              console.log('扫描中, 点击无效')
            } else if (this.state === 'uploading') {
              this.changeState('pause')
            } else if (this.state === 'pause') {
              this.changeState = 'uploading'
            } else if (this.state === 'done') {
              console.log('文件上传成功，点击无效')
            } else if (this.state === 'error') {
              console.log('文件上传失败，点击无效')
            }
          }

          this.button2.onlick = () => {
            if (
              self.state === 'done' ||
              self.state === 'error' ||
              self.state === 'pause'
            ) {
              // 上传完成、上传失败和暂停状态下可以删除 self.changeState( 'del' );
            } else if (self.state === 'sign') {
              console.log('文件正在扫描中，不能删除')
            } else if (self.state === 'uploading') {
              console.log('文件正在上传中，不能删除')
            }
          }
        }

        changeState (state) {
          switch (state) {
            case 'sign':
              this.plugin.sign()
              this.button1.innerHTML = '扫描中，任何操作无效';
              break;
            case 'uploading':
              this.plugin.uploading()
              this.button1.innerHTML = '上传中，点击暂停';
              break;
            case 'pause':
              this.plugin.pause()
              this.button1.innerHTML = '已暂停，点击继续上传';
              break;
            case 'done':
              this.plugin.done()
              this.button1.innerHTML= '上传完成';
              break;
            case 'error':
              this.button1.innerHTML = '上传失败'
              break;
            case 'del'
            this.plugin.del()
            this.button2.innerHTML = '删除完成'
            default:
              break;
          }
        }
      }
    </script>
  </body>
</html>
